<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assessment Library</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script type="module" src="js/utils/utils.js"></script>
    <style>
      :root {
        --primary-color: #447ee2;
        --secondary-color: #447ee2;
        --accent-color: #447ee2;
        --success-color: #4caf50;
        --warning-color: #ff9800;
        --danger-color: #f44336;
        --light-color: #f8f9fa;
        --dark-color: #212529;
        --gray-color: #6c757d;
        --border-radius: 12px;
        --box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
      }

      body {
        background-color: #f5f7fa;
        font-family: "Poppins", sans-serif;
        color: #333;
        padding-left: 280px; /* Added for sidebar */
      }

      /* Sidebar Styles */
      .sidebar {
        border-top-right-radius: 15px;
        border-bottom-right-radius: 15px;
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        width: 300px;
        background: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        padding: 20px 0;
        overflow-y: auto;
      }

      .sidebar-header {
        padding: 0 10px 10px;
        border-bottom: 1px solid #e9e9e9;
        margin-bottom: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .sidebar-logo {
        width: 160px;
      }

      .sidebar-nav {
        padding: 0 15px;
      }

      .nav-item {
        margin-bottom: 5px;
      }

      .nav-link {
        font-size: 14px;
        display: flex;
        align-items: center;
        padding: 12px 15px;
        border-radius: 8px;
        color: #333;
        transition: var(--transition);
      }

      .nav-link:hover,
      .nav-link.active {
        background-color: rgba(68, 126, 226, 0.1);
        color: var(--primary-color);
      }

      .nav-link i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
      }

      .profile-section {
        padding: 15px 20px;
        border-top: 1px solid #eee;
        margin-top: auto;
      }

      .profile-info {
        display: flex;
        align-items: center;
      }

      .profile-picture {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 10px;
        border: 2px solid #447ee2;
      }

      .profile-name {
        font-weight: 600;
        font-size: 14px;
        line-height: 1.2;
      }

      .profile-role {
        font-size: 12px;
        color: var(--gray-color);
      }

      /* Main Content Styles */
      .main-content {
        padding: 30px;
      }

      /* Rest of your existing CSS remains unchanged */
      .btn-primary {
        background-color: var(--primary-color);
      }

      .modal-header {
        background-color: var(--primary-color);
      }

      .btn {
        border-radius: 8px;
        font-weight: 500;
        padding: 8px 16px;
        transition: var(--transition);
      }

      .navbar {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .nav-link-hover:hover {
        color: var(--primary-color) !important;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-weight: 600;
      }

      .display-4 {
        font-weight: 700;
        font-size: 3rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }

      .lead {
        font-size: 1.2rem;
        color: var(--gray-color);
        font-weight: 400;
      }

      .search-container {
        background-color: white;
        border-radius: var(--border-radius);
        padding: 25px;
        box-shadow: var(--box-shadow);
        margin-bottom: 30px;
      }

      .assessment-card {
        transition: all 0.3s ease;
        border: none;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        background: white;
        height: 100%;
      }

      .assessment-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(67, 97, 238, 0.15);
      }

      .status-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
      }

      .badge-draft {
        background-color: rgba(255, 193, 7, 0.2);
        color: #856404;
      }

      .badge-published {
        background-color: rgba(40, 167, 69, 0.2);
        color: #155724;
      }

      .type-badge {
        background-color: #e9ecef;
        color: #495057;
        font-size: 0.8rem;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
      }

      .modal-content {
        border-radius: 12px;
        border: none;
      }

      .modal-header {
        background: var(--primary-color);
        color: white;
        border-radius: 12px 12px 0 0;
      }

      /* Enhanced Question Preview Styles */
      .question-type-container {
        border-left: 2px solid var(--primary-color);
        padding-left: 1rem;
        margin-bottom: 1.5rem;
        background: rgba(68, 126, 226, 0.05);
        border-radius: 8px;
        padding: 1rem;
      }

      .question-options {
        margin-top: 0.5rem;
        padding-left: 1.5rem;
      }

      .question-option {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
      }

      .mindmap-preview {
        padding: 1rem;
        background: white;
        border-radius: 8px;
        border: 1px solid #dee2e6;
      }

      .central-topic {
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }

      .main-branch {
        margin-left: 1.5rem;
        color: var(--secondary-color);
      }

      .sub-branch {
        margin-left: 3rem;
        color: var(--gray-color);
      }

      .comparison-table {
        width: 100%;
        overflow-x: auto;
      }

      .comparison-table table {
        min-width: 600px;
        border-collapse: collapse;
      }

      .comparison-table th,
      .comparison-table td {
        border: 1px solid #dee2e6;
        padding: 0.75rem;
        text-align: left;
      }

      .image-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .image-preview {
        border-radius: 8px;
        overflow: hidden;
        background: #f8f9fa;
        border: 2px solid #dee2e6;
      }

      .image-preview img {
        width: 100%;
        height: 150px;
        object-fit: contain;
        padding: 0.5rem;
      }

      @media (max-width: 992px) {
        body {
          padding-left: 0;
        }

        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          width: 100%;
          padding: 20px;
        }

        .sidebar-toggle {
          display: block !important;
        }
      }

      .sidebar-toggle {
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 1001;
        display: none;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 20px;
        cursor: pointer;
      }

      @media (max-width: 768px) {
        .image-grid {
          grid-template-columns: 1fr;
        }
      }
      .nav-link-hover {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 40px;
        padding: 50px 20px 50px 20px;
        margin: -30px 0 -20px 0;
        transition: background-color 0.3s ease-in-out;
        color: #313131;
      }
      .nav-link-hover:hover {
        color: #447ee2;
        text-decoration: underline;
        text-decoration-thickness: 5px;
        text-underline-offset: 18px;
        transform: translateY(-5px);
      }
      .correct-option {
        background: rgba(76, 175, 80, 0.15);
        border-radius: 4px;
        padding: 8px;
        border-left: 3px solid #4caf50;
        position: relative;
      }

      .correct-option::after {
        content: "\f00c";
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        color: #4caf50;
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
      }
    </style>
  </head>
  <body>
    <div
      class="fullscreen-spinner d-none d-flex justify-content-center align-items-center bg-white"
    >
      <div class="spinner"></div>
    </div>

    <style>
      .fullscreen-spinner {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
      }

      .spinner {
        width: 90px;
        height: 90px;
        display: grid;
      }

      .spinner::before,
      .spinner::after {
        content: "";
        grid-area: 1/1;
        background: radial-gradient(farthest-side, #cb6ce6 92%, #0000) 50% 0,
          /* Top - M */ radial-gradient(farthest-side, #7ed957 92%, #0000) 50%
            100%,
          /* Bottom - a */ radial-gradient(farthest-side, #ffde59 92%, #0000)
            100% 50%,
          /* Right - h */ radial-gradient(farthest-side, #ff914d 92%, #0000) 0
            50%; /* Left - u */
        background-size: 20.4px 20.4px;
        background-repeat: no-repeat;
        animation: spinner-3hs4a3 1s infinite;
      }

      .spinner::before {
        margin: 4.5px;
        background-size: 13px 13px;
        animation-timing-function: linear;
      }

      @keyframes spinner-3hs4a3 {
        100% {
          transform: rotate(0.5turn);
        }
      }
    </style>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
      <div class="sidebar-header">
        <img
          src="/src/images/mahusci-banner-logo.png"
          class="sidebar-logo"
          alt="Logo"
        />
      </div>

      <nav class="sidebar-nav">
        <ul class="nav flex-column">
          <!-- GENERAL -->
          <li
            class="nav-label text-uppercase text-muted px-3 small"
            style="font-size: 13px; color: #447ee2 !important"
          >
            General
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teacher/dashboard.html">
              <i class="fas fa-tachometer-alt"></i>
              <span>Dashboard</span>
            </a>
          </li>

          <!-- MANAGEMENT -->
          <li
            class="nav-label text-uppercase text-muted px-3 mt-3 small"
            style="font-size: 13px; color: #447ee2 !important"
          >
            Management
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teacher/lessons.html">
              <i class="fas fa-book"></i>
              <span> Lessons</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/teacher/assessments.html">
              <i class="fas fa-clipboard-list"></i>
              <span>Assessments</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teacher/manage-sequence.html">
              <i class="fas fa-project-diagram"></i>
              <span> Sequences</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teacher/curriculum-sequence.html">
              <i class="fas fa-sitemap"></i>
              <span class="text-nowrap"> Curriculum Sequence</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teacher/student-results.html">
              <i class="fas fa-user-graduate"></i>
              <span> Student Results</span>
            </a>
          </li>

          <!-- CREATION -->
          <li
            class="nav-label text-uppercase text-muted px-3 mt-3 small pb-1"
            style="font-size: 13px; color: #447ee2 !important"
          >
            Creation
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teacher/sequence-builder.html">
              <i class="fas fa-cogs"></i>
              <span>Sequence Builder</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teacher/create-lesson.html">
              <i class="fas fa-plus-circle"></i>
              <span>Create Lesson</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teacher/create-assessment.html">
              <i class="fas fa-plus-square"></i>
              <span>Create Assessment</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- PROFILE -->
      <div class="profile-section mt-4">
        <a href="myProfile.html" class="text-decoration-none text-reset">
          <div class="profile-info d-flex align-items-center px-3 py-2">
            <img
              src="/src/images/teacher-profile.png"
              class="profile-picture me-2"
              alt="Profile"
            />
            <div>
              <div class="profile-name fw-semibold">Ms. Rodriguez</div>
              <div class="profile-role text-muted small">Science Teacher</div>
            </div>
          </div>
        </a>
      </div>
      <div class="d-flex justify-content-center">
        <button class="w-75 btn-primary btn mt-1" id="btn_logout">
          logout
        </button>
      </div>
    </div>
    <!-- Mobile Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Main Content -->
    <div class="main-content">
      <div class="container">
        <div class="row mb-4">
          <div class="col-12 text-center">
            <h3 class="display-4 fw-bold mb-3">Assessment Library</h3>
            <p class="lead">Manage and organize all your assessments</p>
          </div>
        </div>

        <!-- Filters -->
        <div class="filter-section mb-5 bg-white p-4 rounded-3">
          <div class="mb-2"><span class="fs-6 fw-bold"> Filter</span></div>
          <div class="row g-3">
            <div class="col-md-4">
              <div class="input-group">
                <span class="input-group-text"
                  ><i class="fas fa-search"></i
                ></span>
                <input
                  type="text"
                  id="searchInput"
                  class="form-control"
                  placeholder="Search assessments..."
                />
              </div>
            </div>
            <div class="col-md-3">
              <select id="statusFilter" class="form-select">
                <option value="">All Statuses</option>
                <option value="draft">Draft</option>
                <option value="published">Published</option>
              </select>
            </div>
            <div class="col-md-3">
              <select id="typeFilter" class="form-select">
                <option value="">All Types</option>
                <option value="true_false">True/False</option>
                <option value="short_answer">Short Answer</option>
                <option value="essay">Essay</option>
                <option value="matching">Matching</option>
                <option value="fill_blank">Fill in the Blank</option>
                <option value="4pics1word">4 Pics 1 Word</option>
                <option value="comparison_table">Comparison Table</option>
                <option value="mind_mapping">Mind Mapping</option>
              </select>
            </div>
            <div class="col-md-2">
              <button id="resetFilters" class="btn btn-outline-secondary w-100">
                <i class="fas fa-sync-alt me-2"></i>Reset
              </button>
            </div>
          </div>
        </div>

        <!-- Assessments Grid -->
        <div class="row">
          <div class="col-12 mb-4">
            <div class="d-flex justify-content-between align-items-center">
              <h5><i class="fas fa-list-ul me-2"></i>All Assessments</h5>
              <div>
                <button class="btn btn-primary me-2" id="createNewAssessment">
                  <i class="fas fa-plus-circle me-2"></i>Create New Assessment
                </button>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="row g-4" id="assessmentsContainer">
              <!-- Assessments will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <nav aria-label="Assessment pagination" class="mt-5">
          <ul class="pagination justify-content-center" id="pagination"></ul>
        </nav>
      </div>

      <!-- View Assessment Modal -->
      <div class="modal fade" id="viewAssessmentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Assessment Details</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <div id="modalLoading" class="text-center py-5">
                <div class="spinner-border text-primary"></div>
                <p class="mt-3 text-muted">Loading assessment details...</p>
              </div>

              <div id="modalContent" class="d-none">
                <div class="row">
                  <div class="col-md-8">
                    <h4 id="assessmentTitle" class="mb-3"></h4>
                    <div class="mb-4">
                      <h6 class="text-muted">Instructions</h6>
                      <p id="assessmentInstructions" class="text-break"></p>
                    </div>

                    <div class="row g-3 mb-4">
                      <div class="col-6">
                        <div class="card border-0 bg-light p-3">
                          <small class="text-muted">Questions</small>
                          <h3 id="questionsCount" class="mb-0"></h3>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="card border-0 bg-light p-3">
                          <small class="text-muted">Total Points</small>
                          <h3 id="totalPoints" class="mb-0"></h3>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="card border-0 bg-light p-3">
                      <h6 class="text-muted mb-3">Details</h6>
                      <ul class="list-unstyled">
                        <li class="mb-2">
                          <small class="text-muted">Type:</small>
                          <div id="assessmentType" class="fw-medium"></div>
                        </li>
                        <li class="mb-2">
                          <small class="text-muted">Status:</small>
                          <div>
                            <span id="assessmentStatus" class="badge"></span>
                          </div>
                        </li>
                        <li class="mb-2">
                          <small class="text-muted">Created:</small>
                          <div id="createdDate" class="fw-medium"></div>
                        </li>
                        <li>
                          <small class="text-muted">Last Updated:</small>
                          <div id="updatedDate" class="fw-medium"></div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <div class="mt-4">
                  <h6 class="text-muted mb-3">Questions Preview</h6>
                  <div id="questionsPreview" class="bg-light p-3 rounded"></div>
                </div>
              </div>

              <div id="modalError" class="text-center py-5 d-none">
                <i
                  class="fas fa-exclamation-triangle fa-2x text-danger mb-3"
                ></i>
                <p class="text-danger">Failed to load assessment details</p>
                <button
                  class="btn btn-sm btn-primary"
                  onclick="loadAssessmentDetails()"
                >
                  Try Again
                </button>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const userData = JSON.parse(sessionStorage.getItem("user-data"));
      document.querySelector(".profile-name").textContent =
        userData.firstname + " " + userData.lastname || "-";
      document.querySelector(".profile-role").textContent =
        userData.role || "-";

      // Profile picture
      if (userData.profile_picture) {
        document.querySelector(
          ".profile-picture"
        ).src = `https://mahusci.rubenianinternational.com/storage/app/public/${userData.profile_picture}`;
      } else {
        document.querySelector(".profile-picture").src =
          "/src/images/profile.jpg";
      }
      // Toggle sidebar on mobile
      document
        .getElementById("sidebarToggle")
        .addEventListener("click", function () {
          document.querySelector(".sidebar").classList.toggle("active");
        });

      // Close sidebar when clicking outside on mobile
      document.addEventListener("click", function (event) {
        const sidebar = document.querySelector(".sidebar");
        const toggleBtn = document.getElementById("sidebarToggle");

        if (
          window.innerWidth <= 992 &&
          !sidebar.contains(event.target) &&
          event.target !== toggleBtn &&
          !toggleBtn.contains(event.target)
        ) {
          sidebar.classList.remove("active");
        }
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Sidebar toggle functionality
        const sidebar = document.getElementById("sidebar");
        const sidebarToggle = document.getElementById("sidebarToggle");

        sidebarToggle.addEventListener("click", function () {
          sidebar.classList.toggle("active");
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener("click", function (event) {
          if (
            window.innerWidth <= 992 &&
            !sidebar.contains(event.target) &&
            event.target !== sidebarToggle
          ) {
            sidebar.classList.remove("active");
          }
        });

        // Highlight current page in sidebar
        const currentPage = window.location.pathname.split("/").pop();
        const navLinks = document.querySelectorAll(".nav-link");

        navLinks.forEach((link) => {
          if (link.getAttribute("href").includes(currentPage)) {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
        });

        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(
          document.querySelectorAll('[data-bs-toggle="tooltip"]')
        );
        tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Example assessment card click handler
        document.querySelectorAll(".assessment-card .btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const modal = new bootstrap.Modal(
              document.getElementById("viewAssessmentModal")
            );
            modal.show();
          });
        });

        // Create new assessment button
        document
          .getElementById("createNewAssessment")
          .addEventListener("click", function () {
            window.location.href = "create-assessment.html";
          });
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Existing JavaScript code...

      let currentPage = 1;
      let totalPages = 1;
      const itemsPerPage = 12;
      let currentFilters = { search: "", status: "", type: "" };

      document.addEventListener("DOMContentLoaded", () => {
        loadAssessments();
        setupEventListeners();
      });

      function setupEventListeners() {
        document.getElementById("searchInput").addEventListener(
          "input",
          debounce(() => handleFilterChange("search"), 300)
        );

        document
          .getElementById("statusFilter")
          .addEventListener("change", () => handleFilterChange("status"));

        document
          .getElementById("typeFilter")
          .addEventListener("change", () => handleFilterChange("type"));

        document
          .getElementById("resetFilters")
          .addEventListener("click", resetFilters);
        document
          .getElementById("createNewAssessment")
          .addEventListener("click", () => {
            window.location.href = "create-assessment.html";
          });
      }

      async function loadAssessments() {
        try {
          showLoadingState();
          const params = new URLSearchParams({
            page: currentPage,
            ...currentFilters,
          });

          const response = await fetch(
            `https://mahusci.rubenianinternational.com/public/api/lessons/assessments?${params}`,
            {
              headers: {
                Accept: "application/json",
                Authorization: "Bearer " + sessionStorage.getItem("token"),
              },
            }
          );
          const { data, meta } = await response.json();

          totalPages = meta.last_page;
          displayAssessments(data);
          updatePagination();
        } catch (error) {
          showErrorState(error);
        }
      }

      function displayAssessments(assessments) {
        const container = document.getElementById("assessmentsContainer");
        container.innerHTML =
          assessments.length > 0
            ? assessments
                .map(
                  (assessment) => `
            <div class="col-md-6 col-lg-4">
              <div class="assessment-card p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <span class="status-badge ${getStatusClass(
                    assessment.status
                  )}">
                    ${assessment.status}
                  </span>
                  <small class="text-muted">
                    ${new Date(assessment.created_at).toLocaleDateString()}
                  </small>
                </div>

                <h5 class="mb-3">${assessment.title}</h5>

                <div class="d-flex align-items-center mb-3">
                  <span class="type-badge me-2">
                    ${formatType(assessment.type)}
                  </span>
                  <span class="text-muted small">
                    ${assessment.questions_count} questions
                  </span>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                  <button class="btn btn-sm btn-outline-primary view-assessment-btn"
                    data-bs-toggle="modal"
                    data-bs-target="#viewAssessmentModal"
                    data-id="${assessment.id}">
                    <i class="fas fa-eye me-2"></i>View
                  </button>
                  <span class="text-muted small">
                    ${assessment.points} points
                  </span>
                </div>
              </div>
            </div>
          `
                )
                .join("")
            : showEmptyState();

        // Add event listeners to view buttons
        document.querySelectorAll(".view-assessment-btn").forEach((button) => {
          button.addEventListener("click", function () {
            const assessmentId = this.dataset.id;
            console.log(assessmentId);
            loadAssessmentDetails(assessmentId);
          });
        });
      }

      function renderQuestionPreview(question, index, type) {
        let html = `<div class="question-type-container mb-3">`;
        html += `<h6 class="mb-2">Question ${index + 1}</h6>`;

        console.log(question);

        switch (type) {
          case "multiple_choice":
            html += `<div class="question-options">`;
            question.options.forEach((option) => {
              const isCorrect = option.value === question.correctAnswer;
              html += `
      <div class="question-option ${isCorrect ? "correct-option" : ""}">
        <input type="radio" ${isCorrect ? "checked" : ""} disabled>
        <span>${option.value}. ${option.text}</span>
      </div>`;
            });
            html += `</div>`;
            break;

          case "true_false":
            html += `<div class="question-options"><p>${question.text}</p>`;
            ["true", "false"].forEach((answer) => {
              const isCorrect = answer === question.correctAnswer;
              html += `
      <div class="question-option ${isCorrect ? "correct-option" : ""}">
        <input type="radio" ${isCorrect ? "checked" : ""} disabled>
        <span>${answer.charAt(0).toUpperCase() + answer.slice(1)}</span>
      </div>`;
            });
            html += `</div>`;
            break;

          case "essay":
            html += `<div class="bg-white p-2 rounded">
                <small class="text-muted">Rubric:</small>
                <pre class="mb-0">${
                  question.rubric || "No rubric provided"
                }</pre>
              </div>`;
            break;

          case "mind_mapping":
            html += `<div class="mindmap-preview">`;
            html += `<div class="central-topic">${question.centralTopic}</div>`;

            question.branches.forEach((branch) => {
              html += `<div class="main-branch">${branch.name}</div>`;

              const subBranches = branch.subBranches.split(",");
              subBranches.forEach((sub) => {
                html += `<div class="sub-branch ms-5">- ${sub.trim()}</div>`;
              });
            });

            html += `</div>`;
            break;

          case "4pics1word":
            html += `<div class="image-grid">`;
            question.images.forEach((img) => {
              console.log(img);
              html += `<div class="image-preview">
              <img src="https://mahusci.rubenianinternational.com/storage/app/public/${img}" alt="Question image" onerror="this.style.display='none';">
          </div>`;
            });
            html += `</div>
      <div class="text-center fw-medium">
          Answer: ${question.correctAnswer} <br>
      ${question.hint !== null ? `Hint: ${question.hint}` : ``}
      </div>`;
            break;

          case "comparison_table":
            html += `<div class="comparison-table">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th></th> <!-- Empty header for row labels -->
          ${question.headers.map((h) => `<th>${h}</th>`).join("")}
        </tr>
      </thead>
      <tbody>
        ${question.rowLabels
          .map(
            (rowLabel) => `
              <tr>
                <td><strong>${rowLabel}</strong></td>
                ${question.headers.map(() => `<td></td>`).join("")}
              </tr>
            `
          )
          .join("")}
      </tbody>
    </table>
  </div>`;

            // Render the correct answer table
            if (question.correctAnswers && question.correctAnswers.length > 0) {
              const answerHeaders = Object.keys(question.correctAnswers[0]);
              html += `<div class="mt-4"><strong>Correct Answer:</strong></div>`;
              html += `<table class="table table-bordered">
      <thead>
        <tr>
          ${answerHeaders.map((h) => `<th>${h}</th>`).join("")}
        </tr>
      </thead>
      <tbody>
        ${question.correctAnswers
          .map(
            (answer) => `
              <tr>
                ${answerHeaders.map((h) => `<td>${answer[h]}</td>`).join("")}
              </tr>`
          )
          .join("")}
      </tbody>
    </table>`;
            }
            break;

          default:
            html += `<div class="bg-white p-2 rounded">
                <pre class="mb-0">${JSON.stringify(question, null, 2)}</pre>
              </div>`;
        }

        html += `</div>`;
        return html;
      }

      // Modified loadAssessmentDetails function
      async function loadAssessmentDetails(assessmentId) {
        console.log(assessmentId);

        try {
          showModalLoading();
          const response = await fetch(
            `https://mahusci.rubenianinternational.com/public/api/lessons/assessments/${assessmentId}`,
            {
              headers: {
                Accept: "application/json",
                Authorization: "Bearer " + sessionStorage.getItem("token"),
              },
            }
          );
          const data = await response.json();
          const assessment = data.data;

          console.log(assessment);

          // Update basic info
          document.getElementById("assessmentTitle").textContent =
            assessment.title;
          document.getElementById("assessmentInstructions").innerHTML =
            assessment.instructions || "No instructions provided";
          document.getElementById("questionsCount").textContent =
            assessment.questions_count;
          document.getElementById("totalPoints").textContent =
            assessment.points;
          document.getElementById("assessmentType").textContent = formatType(
            assessment.type
          );
          document.getElementById(
            "assessmentStatus"
          ).className = `status-badge ${getStatusClass(assessment.status)}`;
          document.getElementById("createdDate").textContent = new Date(
            assessment.created_at
          ).toLocaleDateString();
          document.getElementById("updatedDate").textContent = new Date(
            assessment.updated_at
          ).toLocaleDateString();

          // Render questions
          const questionsPreview = document.getElementById("questionsPreview");
          questionsPreview.innerHTML = assessment.questions
            .map((q, i) => renderQuestionPreview(q, i, assessment.type))
            .join("");

          showModalContent();
        } catch (error) {
          showModalError();
        }
      }

      // Helper functions
      function showModalLoading() {
        document.getElementById("modalLoading").classList.remove("d-none");
        document.getElementById("modalContent").classList.add("d-none");
        document.getElementById("modalError").classList.add("d-none");
      }

      function showModalContent() {
        document.getElementById("modalLoading").classList.add("d-none");
        document.getElementById("modalContent").classList.remove("d-none");
      }

      function showModalError() {
        document.getElementById("modalLoading").classList.add("d-none");
        document.getElementById("modalError").classList.remove("d-none");
      }

      function getStatusClass(status) {
        return status === "draft" ? "badge-draft" : "badge-published";
      }

      // Helper Functions
      function showLoadingState() {
        assessmentsContainer.innerHTML = `
                  <div class="col-12">
                      <div class="text-center py-5">
                          <div class="spinner-border text-primary" role="status">
                              <span class="visually-hidden">Loading...</span>
                          </div>
                          <p class="mt-3 text-muted">Loading assessments...</p>
                      </div>
                  </div>`;
      }

      function showErrorState(error) {
        assessmentsContainer.innerHTML = `
                  <div class="col-12">
                      <div class="empty-state">
                          <i class="fas fa-exclamation-triangle fa-4x text-danger mb-4"></i>
                          <h4 class="text-danger mb-3">Error loading assessments</h4>
                          <p>${error.message}</p>
                          <button class="btn btn-primary mt-3" onclick="loadAssessments()">
                              <i class="fas fa-redo me-2"></i>Try Again
                          </button>
                      </div>
                  </div>`;
      }

      function showEmptyState() {
        return `
          <div class="col-12">
              <div class="empty-state text-center">
                  <i class="fas fa-search fa-2x text-muted mb-4"></i>
                  <h5 class="text-muted mb-3">No Assessments Found</h5>
                  <p>We couldn't find any assessments matching your filter.</p>
              </div>
          </div>`;
      }

      function formatType(type) {
        const types = {
          multiple_choice: "Multiple Choice",
          true_false: "True/False",
          essay: "Essay",
          short_answer: "Short Answer",
          matching: "Matching",
          fill_blank: "Fill in Blank",
          comparison_table: "Comparison Table",
          mind_mapping: "Mind Mapping",
        };
        return types[type] || type;
      }

      function debounce(func, timeout = 300) {
        let timer;
        return (...args) => {
          clearTimeout(timer);
          timer = setTimeout(() => func.apply(this, args), timeout);
        };
      }

      // Pagination and filter functions remain similar to previous implementation
      function updatePagination() {
        pagination.innerHTML = `
                  <li class="page-item ${currentPage === 1 ? "disabled" : ""}">
                      <a class="page-link" onclick="changePage(${
                        currentPage - 1
                      })">
                          <i class="fas fa-chevron-left"></i>
                      </a>
                  </li>

                  ${Array.from(
                    { length: totalPages },
                    (_, i) => `
                      <li class="page-item ${
                        i + 1 === currentPage ? "active" : ""
                      }">
                          <a class="page-link" onclick="changePage(${i + 1})">${
                      i + 1
                    }</a>
                      </li>
                  `
                  ).join("")}

                  <li class="page-item ${
                    currentPage === totalPages ? "disabled" : ""
                  }">
                      <a class="page-link" onclick="changePage(${
                        currentPage + 1
                      })">
                          <i class="fas fa-chevron-right"></i>
                      </a>
                  </li>
              `;
      }

      function handleFilterChange(filterType) {
        currentFilters = {
          ...currentFilters,
          [filterType]: document.getElementById(`${filterType}Filter`).value,
        };
        currentPage = 1;
        loadAssessments();
      }

      function resetFilters() {
        document.getElementById("searchInput").value = "";
        document.getElementById("statusFilter").value = "";
        document.getElementById("typeFilter").value = "";
        currentFilters = { search: "", status: "", type: "" };
        currentPage = 1;
        loadAssessments();
      }

      function changePage(newPage) {
        if (newPage < 1 || newPage > totalPages) return;
        currentPage = newPage;
        loadAssessments();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    </script>
  </body>
</html>
